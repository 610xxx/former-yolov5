# YOLOv5 ðŸš€ by Ultralytics, GPL-3.0 license

# Parameters    efficentnetv2é€šè¿‡æœç´¢èƒ½ä¾æ®è®­ç»ƒå¤§å°è‡ªé€‚åº”è°ƒæ•´æ­£åˆ™åŒ–å‚æ•°--ï¼ˆï¼‰
nc: 80  # number of classes
depth_multiple: 1.0  # model depth multiple
width_multiple: 1.0  # layer channel multiple  L /44GFLOPS     fusedmbconv/mbconvæ·±åº¦å¯åˆ†ç¦»æ‰©å¼ å·ç§¯ï¼Œæœ¬è´¨è¿˜æ˜¯è½»é‡çº§åˆ«å¾—çš„ç½‘ç»œï¼Œå—é™ç§»åŠ¨è®¾å¤‡ï¼Œç½‘ç»œå¤æ‚åº¦ä½Ž
anchors:
  # - [10,13, 16,30, 33,23]  # P3/8
  # - [30,61, 62,45, 59,119]  # P4/16
  # - [116,90, 156,198, 373,326]  # P5/32

   - [5,6, 9,4, 7,9] #å° face
   - [19,8, 11,14, 33,19]
   - [23,32, 56,29, 89,43] #é«˜  plate

# s6
  # - [5,6, 9,4, 7,9] 
  # - [9,12, 17,7, 11,15] 
  # - [13,18, 15,21, 29,12] 
  # - [23,31, 46,20, 70,35]
# YOLOv5 v6.0 backbone   ðŸ’Š   efficientnetv2 ã€ å‚ç…§ç½‘ç»œç»“æž„-å–„å¸¸åˆ†ç±»ä»»åŠ¡ï¼Œç›®æ ‡æ£€æµ‹ç¨æ¬¡ï¼ˆobj/box/clsæŸå¤±è¾ƒå¤§ï¼‰ã€‘ ç†è®ºç²¾å‡†åº¦ä¸Žswintransformerä¸€æ ·,ï¼Ÿï¼Ÿï¼Ÿ
backbone:
  [[-1, 1, stem, [24, 3, 2]],  # 0-P1/2 efficientnetv2 ä¸€å¼€å§‹æ˜¯Stem = æ™®é€šçš„å·ç§¯+bn+æ¿€æ´»  640*640*3 --> 320*320*24
#                    # [out_channel,kernel_size,stride,expansion,se_ration]
                     #[[è¾“å‡ºï¼Œå†…æ ¸ã€æ­¥å¹…ã€å¡«å……ã€ç»„]  enfficientnetv2 
   [-1, 2, FusedMBConv, [24, 3, 1, 1, 0]], # 1 2ä¸ªFusedMBConv=3*3conv+se+1*1conv   320*320*24-->320*320*24      é˜‰å‰²äº†å·ç§¯æ­¥éª¤ï¼Œä¸»è¦ä¸ºéƒ¨ç½²ç§»åŠ¨ç«¯ï¼Œä¸è¿½æ±‚æ¨¡åž‹å¤§å°æ—¶ï¼Œä¸å»ºè®®ä½¿ç”¨

   [-1, 1, FusedMBConv, [48, 3, 2, 4, 0]], # 2 è¿™é‡Œstrid2=2ï¼Œç‰¹å¾å›¾å°ºå¯¸ç¼©å°ä¸€åŠï¼Œexpansion=4è¾“å‡ºç‰¹å¾å›¾çš„æ·±åº¦å˜ä¸ºåŽŸæ¥çš„4å€ 320*320*24-->160*160*48
   [-1, 3, FusedMBConv, [48, 3, 1, 4, 0]], # 3 EfficientNetV2ç»“æž„ï¼Œè½»é‡åŒ–   ---è‡ªé€‚åº”å›¾åƒå¤§å°å› å­

   [-1, 1, FusedMBConv, [64, 3, 2, 4, 0]], # 4 160*160*48-->80*80*64
   [-1, 3, FusedMBConv, [64, 3, 1, 4, 0]], # 5   â€œæ‰©å¼ ï¼Œåˆ†ç¦»ï¼ŒæŠ•å½±â€ç†è®º>convæ“ä½œ

   [-1, 1, MBConv, [128, 3, 2, 4, 0.25]], # 6  è¿™é‡Œstrid2=2ï¼Œç‰¹å¾å›¾å°ºå¯¸ç¼©å°ä¸€åŠï¼Œ 40*40*128    c3
   [-1, 5, MBConv, [128, 3, 1, 4, 0.25]], # 7

   [-1, 1, MBConv, [160, 3, 2, 6, 0.25]], # 8 è¿™é‡Œ strid2=2ï¼Œç‰¹å¾å›¾å°ºå¯¸ç¼©å°ä¸€åŠï¼Œ20*20*160    c3
   [-1, 8, MBConv, [160, 3, 1, 6, 0.25]], # 9   stage5æ­¥é•¿1

   [-1, 1, MBConv, [256, 3, 2, 4, 0.25]], # 10 è¿™é‡Œstrid2=2ï¼Œç‰¹å¾å›¾å°ºå¯¸ç¼©å°ä¸€åŠï¼Œ10*10*160  æ›¿æ¢c3
   [-1, 14, MBConv, [256, 3, 1, 4, 0.25]], # 11
  
  #  [-1, 3, C3, [1024]],
  #  [-1, 3, CBAM, [1024]], #  13ðŸ’Šbackboneç¬¬nå±‚æ•°æ·»åŠ å°±åœ¨headä¸­æ³¨æ„ç›¸åº”æ·»åŠ å±‚ðŸ’Š  headç”¨å¤šå±‚concatç»“åˆ é€šé“ä¸åŒ¹é…ï¼Œ256--1024ï¼ˆMBconvï¼‰--æ›¿æ¢ç›¸åŒå³å¯ï¼Œé€šé“åŒä¸Š
   [-1, 1, SPPF, [1024, 5]], #12 
  ]
# YOLOv5 v6.0 head   headå±‚æ³¨æ„åŠ›æœºåˆ¶ä¸ç¨³å®š
head:
  [[-1, 1, Conv, [512, 1, 1]], # 13  10*10
   [-1, 1, nn.Upsample, [None, 2, 'nearest']], # 14  20*20
   [[-1, 9], 1, Concat, [1]],  # 15 cat backbone P4 15  è¿™é‡Œç‰¹å¾å›¾å¤§å°ä¸º20*20ï¼Œæ‰€ä»¥åº”è¯¥å’Œ9å·è¿žæŽ¥ðŸ’£   è§†MBconvä¸ºc3
   [-1, 3, C3, [512, False]],  # 16 20*20
   #[-1, 3, CBAM, [512]],  #ðŸ’Š å¯¹åº”c3å¤§å°  17

   [-1, 1, Conv, [256, 1, 1]], #17  20*20  
   [-1, 1, nn.Upsample, [None, 2, 'nearest']], #18 40*40
   [[-1, 7], 1, Concat, [1]],  # cat backbone P3 19  7å·ç‰¹å¾å›¾å¤§å°ä¹Ÿæ˜¯40*40ðŸ’£   è§†MBconvä¸ºc3
   [-1, 3, C3, [256, False]],  # 20 (P3/8-small)  
   #[-1, 3, CBAM, [256]],  #ðŸ’Š  22

   [-1, 1, Conv, [256, 3, 2]],  #21  å·ç§¯æ­¥é•¿ä¸º2ï¼Œæ‰€ä»¥ç‰¹å¾å›¾å°ºå¯¸ç¼©å°ï¼Œä¸º 20*20    
   [[-1, 17], 1, Concat, [1]],  # cat head P4  17å±‚çš„ç‰¹å¾å›¾ä¹Ÿæ˜¯20*20ðŸ’£   [[-1, 17]--->[[-1, 18]âœ…
   [-1, 3, C3, [512, False]],  # 23 (P4/16-medium) 
   #[-1, 3, CBAM, [512]],  #ðŸ’Š 26
    
   [-1, 1, Conv, [512, 3, 2]],  # 24  10*10    
   [[-1, 13], 1, Concat, [1]],  # cat head P5  13å±‚çš„ç‰¹å¾å›¾å¤§å°å°±æ˜¯10*10 ðŸ’£ BiFPN_Concat2  [[-1, 13]-->[[-1, 14]â˜‘ï¸âœ…
   [-1, 3, C3, [1024, False]], # 26 (P5/32-large)
   #[-1, 3, CBAM, [1024]],  #ðŸ’Š  30 headç»“åˆæ³¨æ„detectå¯¹åº”c3æ£€æµ‹å±‚--conv/catå¯èƒ½ä¸è¡Œ

   #ä¸‰ä¸ªæ£€æµ‹å¤´ï¼Œå¯¹åº”anchorsï¼Œåˆ†åˆ«æ¥è‡ª24ï¼Œ27ï¼Œ30ï¼Œå±‚ é€‰ç”¨å¤´éƒ¨c3
   [[20, 23, 26], 1, Detect, [nc, anchors]],  #âœ”ï¸ Detect(P3, P4, P5)  [20, 23, 26]-->[21, 24, 27]       +3
  ]
# âœ’ï¸SwinStage æ¨¡å—å’Œ EfficientNetV2 ä¸­å·²ç»å¼•å…¥äº†è‡ªæ³¨æ„åŠ›æœºåˆ¶âœ’ï¸æ·»åŠ cbamç©ºé—´é€šé“æ—¶éœ€è¦è°ƒæ•´ï¼Œå†²çªè¾ƒå¤§
# " 
# # [[24, 27, 30], 1, Detect, [nc, anchors]] æ£€æµ‹å±‚éƒ½æ˜¯c3  cat/addå±‚c3/convå¹³åˆ†
# #
# #
# v5s6
# head:
#   [[-1, 1, Conv, [768, 1, 1]],  #å¦å¢žåŠ 768ðŸš€    
#    [-1, 1, nn.Upsample, [None, 2, 'nearest']], #ä¸Šé‡‡æ ·ï¼Œwx2ï¼Œhx2  æœ€è¿‘é‚»æ’å€¼
#    #[-1, 1, nn.ConvTranspose2d, [768, 4, 2, 1, 0, 768]], #è®¾ç½®è½¬ç½®å·ç§¯
#    [[-1, 8], 1, BiFPN_Concat2, [1]],  # cat backbone P5              Concat, [1]]--->   BIFPN_Add2, [384,384]],---464/s   ---576/m
#    [-1, 3, C3, [768, False]],  # 15

#    [-1, 1, Conv, [512, 1, 1]],
#    [-1, 1, nn.Upsample, [None, 2, 'nearest']],  
#    [[-1, 6], 1, BiFPN_Concat2, [1]],  # cat backbone P4                  Concat, [1]]--->   BIFPN_Add2, [256,256]]   --312/s   --384/m
#    [-1, 3, C3, [512, False]],  # 19

#    [-1, 1, Conv, [256, 1, 1]],       #backboneä¸Šæ·»åŠ å±‚æ•°headåŽ9å±‚æ·»åŠ 
#    [-1, 1, nn.Upsample, [None, 2, 'nearest']],    
#    [[-1, 4], 1, BiFPN_Concat2, [1]],  # cat backbone P3    ðŸš€                Concat æ›´æ¢bifpn_Add,ç›¸åº”æ›´æ”¹é€šé“    Concat, [1]]--->BIFPN_Add2, [128, 128]],---160/s---192/m
#    [-1, 3, C3, [256, False]],  # 23 (P3/8-small)

#    [-1, 1, Conv, [256, 3, 2]], 
#    #[-1, 1, nn.Upsample, [None, 2, 'nearest']],  
#    [[-1, 21], 1, BiFPN_Concat2, [1]],  # cat head P4   ðŸš€               +1     Concat, [1]],  --->[128, 128]],        --160/s   --192/m
#    [-1, 3, C3, [512, False]],  # 26 (P4/16-medium)

#    [-1, 1, Conv, [512, 3, 2]],
#    [[-1, 17], 1, BiFPN_Concat2, [1]],  # cat head P5              +1           Concat, [1]],--->[256, 256]],     ---312/s  ---384/m
#    [-1, 3, C3, [768, False]],  # 29 (P5/32-large)

#    [-1, 1, Conv, [768, 3, 2]],    #å¦å¢ž768ðŸš€
#    [[-1, 13], 1, BiFPN_Concat2, [1]],  # cat head P6              +1      Concat, [1]],--->[384, 384]],    -----464/s    --576/m
#    [-1, 3, C3, [1024, False]], # 32 (P6/64-xlarge)  

#    [[24, 27, 30, 33], 1, Detect, [nc, anchors]],
   
# 